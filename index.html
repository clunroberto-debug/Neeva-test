<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Neeva – Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #050816;
      color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }
    h1, h2, h3 {
      margin: 0 0 8px;
    }
    h1 {
      text-align: center;
      margin-bottom: 16px;
    }
    .subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: #cbd5f5;
      margin-bottom: 24px;
    }
    .board {
      display: grid;
      grid-template-columns: 1.2fr 1.2fr 1fr;
      gap: 12px;
      align-items: flex-start;
    }
    .panel {
      background: linear-gradient(145deg,#0b1020,#12172b);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #1f2937;
      color: #e5e7eb;
    }
    .champ-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .champ-card {
      border-radius: 10px;
      padding: 8px;
      background: #111827;
      border: 1px solid rgba(255,255,255,0.08);
      position: relative;
    }
    .champ-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }
    .champ-name {
      font-weight: 600;
      font-size: 0.95rem;
    }
    .champ-hp {
      font-size: 0.85rem;
    }
    .hp-bar-bg {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #374151;
      overflow: hidden;
      margin-bottom: 4px;
    }
    .hp-bar-fill {
      height: 6px;
      background: linear-gradient(90deg,#34d399,#22c55e);
      width: 100%;
      transition: width 0.2s ease-out;
    }
    .champ-stats {
      font-size: 0.75rem;
      color: #d1d5db;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .stat-pill {
      background: rgba(15,23,42,0.8);
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.3);
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.8rem;
      cursor: pointer;
      background: #2563eb;
      color: #f9fafb;
      transition: background 0.15s, transform 0.1s;
    }
    button:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }
    button:disabled {
      background: #4b5563;
      cursor: default;
      transform: none;
    }
    .btn-secondary {
      background: #1f2937;
    }
    .btn-secondary:hover {
      background: #111827;
    }
    .log {
      font-size: 0.8rem;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .log-entry {
      margin-bottom: 4px;
    }
    .log-entry span.turn-tag {
      font-size: 0.7rem;
      padding: 1px 6px;
      border-radius: 999px;
      margin-right: 4px;
    }
    .turn-player {
      background: rgba(34,197,94,0.16);
      color: #bbf7d0;
    }
    .turn-enemy {
      background: rgba(239,68,68,0.16);
      color: #fecaca;
    }
    .turn-info {
      background: rgba(59,130,246,0.16);
      color: #bfdbfe;
    }
    .turn-bar {
      text-align: center;
      margin: 8px 0 12px;
      font-size: 0.85rem;
      color: #e5e7eb;
    }
    .pill {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(148,163,184,0.4);
    }
    .pill.player {
      background: rgba(34,197,94,0.12);
      color: #bbf7d0;
    }
    .pill.enemy {
      background: rgba(248,113,113,0.12);
      color: #fecaca;
    }
    .footer {
      margin-top: 16px;
      font-size: 0.72rem;
      color: #9ca3af;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>Neeva – Prototype</h1>
    <div class="subtitle">
      Prototipo ultra semplificato: 3v3, turni alternati, attacchi base.  
      <br />Serve solo per testare il flusso di combattimento, non è il regolamento completo.
    </div>

    <div class="turn-bar">
      Turno: <span id="turnNumber">1</span> ·
      <span id="turnOwnerPill" class="pill player">Tocca a TE</span>
    </div>

    <div class="board">
      <!-- PANNELLO GIOCATORE -->
      <div class="panel">
        <div class="panel-header">
          <h2>La tua squadra</h2>
          <span class="badge">Giocatore</span>
        </div>
        <div id="playerTeam" class="champ-list"></div>
      </div>

      <!-- PANNELLO NEMICO -->
      <div class="panel">
        <div class="panel-header">
          <h2>Squadra nemica</h2>
          <span class="badge">Bot</span>
        </div>
        <div id="enemyTeam" class="champ-list"></div>
      </div>

      <!-- PANNELLO LOG / CONTROLLI -->
      <div class="panel">
        <div class="panel-header">
          <h3>Log combattimento</h3>
          <button id="btnNewGame" class="btn-secondary">Nuova partita</button>
        </div>
        <div id="log" class="log"></div>
      </div>
    </div>

    <div class="footer">
      Questo è solo un prototipo di test. Le statistiche, i danni e le regole sono
      semplificati. L’obiettivo è avere una base cliccabile per poi inserire le
      vere regole di Neeva (mana, carte, crit, debuff, ecc.).
    </div>
  </div>

  <script>
    // --- Modello semplificato di Champion per il prototipo ---
    const BASE_CHAMPIONS = {
      Basil:   { maxLP: 980,  ATK: 63, DEF: 40 },
      Gael:    { maxLP: 900,  ATK: 72, DEF: 11 },
      Zagrok:  { maxLP: 830,  ATK: 68, DEF: 13 },
      Mordel:  { maxLP: 1020, ATK: 60, DEF: 32 },
      Kiddou:  { maxLP: 820,  ATK: 58, DEF: 23 },
      Rindu:   { maxLP: 860,  ATK: 78, DEF: 28 },
    };

    let state = {
      turn: 1,
      currentPlayer: "player", // "player" o "enemy"
      playerTeam: [],
      enemyTeam: [],
      gameOver: false,
    };

    function cloneChampion(name) {
      const base = BASE_CHAMPIONS[name];
      return {
        name,
        maxLP: base.maxLP,
        lp: base.maxLP,
        ATK: base.ATK,
        DEF: base.DEF,
      };
    }

    function initGame() {
      state.turn = 1;
      state.currentPlayer = "player";
      state.gameOver = false;
      state.playerTeam = [
        cloneChampion("Basil"),
        cloneChampion("Gael"),
        cloneChampion("Zagrok"),
      ];
      state.enemyTeam = [
        cloneChampion("Mordel"),
        cloneChampion("Kiddou"),
        cloneChampion("Rindu"),
      ];
      document.getElementById("log").innerHTML = "";
      logInfo("Nuova partita iniziata! Basil, Gael e Zagrok contro Mordel, Kiddou e Rindu.");
      render();
    }

    // --- Logging ---
    function log(message, type = "info") {
      const logDiv = document.getElementById("log");
      const entry = document.createElement("div");
      entry.className = "log-entry";
      const tag = document.createElement("span");
      tag.classList.add("turn-tag");
      if (type === "player") tag.classList.add("turn-player");
      else if (type === "enemy") tag.classList.add("turn-enemy");
      else tag.classList.add("turn-info");
      tag.textContent = type === "player" ? "TU" : type === "enemy" ? "BOT" : "INFO";
      const text = document.createElement("span");
      text.textContent = " " + message;
      entry.appendChild(tag);
      entry.appendChild(text);
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }
    function logPlayer(msg) { log(msg, "player"); }
    function logEnemy(msg) { log(msg, "enemy"); }
    function logInfo(msg) { log(msg, "info"); }

    // --- Utilità ---
    function isAlive(champ) {
      return champ.lp > 0;
    }

    function getAlive(team) {
      return team.filter(isAlive);
    }

    function computeDamage(attacker, defender) {
      const raw = attacker.ATK - defender.DEF;
      return raw > 0 ? raw : 1; // minimo 1 per non avere scontri eterni nel prototipo
    }

    function attack(attacker, defender, side) {
      if (!isAlive(attacker) || !isAlive(defender)) return;
      const dmg = computeDamage(attacker, defender);
      defender.lp -= dmg;
      if (defender.lp < 0) defender.lp = 0;
      const msg = `${attacker.name} colpisce ${defender.name} per ${dmg} danni (LP ${defender.lp}/${defender.maxLP}).`;
      if (side === "player") logPlayer(msg);
      else logEnemy(msg);

      if (defender.lp === 0) {
        const deathMsg = `${defender.name} è stato sconfitto!`;
        if (side === "player") logPlayer(deathMsg);
        else logEnemy(deathMsg);
      }
    }

    function checkGameOver() {
      const playerAlive = getAlive(state.playerTeam).length;
      const enemyAlive = getAlive(state.enemyTeam).length;
      if (playerAlive === 0 && enemyAlive === 0) {
        logInfo("Pareggio! Tutti i personaggi sono stati sconfitti.");
        state.gameOver = true;
      } else if (playerAlive === 0) {
        logEnemy("Il bot vince la partita!");
        state.gameOver = true;
      } else if (enemyAlive === 0) {
        logPlayer("Hai vinto la partita!");
        state.gameOver = true;
      }
      return state.gameOver;
    }

    // --- Turni ---
    function endTurn() {
      if (state.gameOver) return;
      if (state.currentPlayer === "player") {
        state.currentPlayer = "enemy";
        render();
        setTimeout(enemyTurn, 600); // piccolo delay per “sentire” il bot
      } else {
        state.currentPlayer = "player";
        state.turn += 1;
        render();
      }
    }

    function enemyTurn() {
      if (state.gameOver) return;

      const enemyAlive = getAlive(state.enemyTeam);
      const playerAlive = getAlive(state.playerTeam);

      if (enemyAlive.length === 0 || playerAlive.length === 0) {
        checkGameOver();
        return;
      }

      const attacker = enemyAlive[Math.floor(Math.random() * enemyAlive.length)];
      const defender = playerAlive[Math.floor(Math.random() * playerAlive.length)];

      attack(attacker, defender, "enemy");
      if (!checkGameOver()) {
        endTurn();
      }
    }

    // --- Azioni del giocatore ---
    function playerAttack(attackerIndex, defenderIndex) {
      if (state.gameOver) return;
      if (state.currentPlayer !== "player") return;

      const attacker = state.playerTeam[attackerIndex];
      const defender = state.enemyTeam[defenderIndex];

      if (!isAlive(attacker) || !isAlive(defender)) return;

      attack(attacker, defender, "player");
      if (!checkGameOver()) {
        endTurn();
      } else {
        render();
      }
    }

    // --- Rendering UI ---
    function renderTeam(team, containerId, side) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";

      team.forEach((champ, idx) => {
        const card = document.createElement("div");
        card.className = "champ-card";

        const header = document.createElement("div");
        header.className = "champ-header";

        const nameEl = document.createElement("div");
        nameEl.className = "champ-name";
        nameEl.textContent = champ.name;

        const hpEl = document.createElement("div");
        hpEl.className = "champ-hp";
        hpEl.textContent = `LP ${champ.lp} / ${champ.maxLP}`;

        header.appendChild(nameEl);
        header.appendChild(hpEl);

        const hpBarBg = document.createElement("div");
        hpBarBg.className = "hp-bar-bg";
        const hpBarFill = document.createElement("div");
        hpBarFill.className = "hp-bar-fill";
        const hpPerc = (champ.lp / champ.maxLP) * 100;
        hpBarFill.style.width = hpPerc + "%";
        hpBarBg.appendChild(hpBarFill);

        const stats = document.createElement("div");
        stats.className = "champ-stats";

        const atk = document.createElement("span");
        atk.className = "stat-pill";
        atk.textContent = `ATK ${champ.ATK}`;

        const def = document.createElement("span");
        def.className = "stat-pill";
        def.textContent = `DEF ${champ.DEF}`;

        stats.appendChild(atk);
        stats.appendChild(def);

        card.appendChild(header);
        card.appendChild(hpBarBg);
        card.appendChild(stats);

        // Pulsanti di attacco SOLO per i tuoi campioni
        if (side === "player" && state.currentPlayer === "player" && !state.gameOver && champ.lp > 0) {
          const btnRow = document.createElement("div");
          btnRow.className = "btn-row";

          getAlive(state.enemyTeam).forEach((enemyChamp) => {
            const enemyIndex = state.enemyTeam.indexOf(enemyChamp);
            const btn = document.createElement("button");
            btn.textContent = `Attacca ${enemyChamp.name}`;
            btn.onclick = () => playerAttack(idx, enemyIndex);
            btnRow.appendChild(btn);
          });

          card.appendChild(btnRow);
        }

        if (champ.lp <= 0) {
          card.style.opacity = 0.5;
        }

        container.appendChild(card);
      });
    }

    function render() {
      renderTeam(state.playerTeam, "playerTeam", "player");
      renderTeam(state.enemyTeam, "enemyTeam", "enemy");

      document.getElementById("turnNumber").textContent = state.turn;
      const pill = document.getElementById("turnOwnerPill");
      if (state.currentPlayer === "player") {
        pill.textContent = "Tocca a TE";
        pill.className = "pill player";
      } else {
        pill.textContent = "Tocca al BOT";
        pill.className = "pill enemy";
      }

      if (state.gameOver) {
        pill.textContent = "Partita finita";
      }
    }

    document.getElementById("btnNewGame").addEventListener("click", initGame);

    // Avvio
    initGame();
  </script>
</body>
</html>
